<!DOCTYPE html>
<html lang="es">
<link rel="stylesheet" href="./css/photon.min.css">
<link rel="stylesheet" href="./css/main.css">
<head>
	<title>Rasskin Data Logger</title>
</head>
<body>
	<div class="window">
		<div class="window-content">
			<div class="pane-group">
				<div class="pane-sm sidebar">
					<ul class="list-group">
						<li class="list-group-item">
							<button class="btn btn-large btn-default form-control">Grabar datos</button>
						</li>
					</ul>
					<ul class="list-group" id="trace-config">
					</ul>
				</div>
				<div class="pane">
					<div id="live-plot"></div>
					<div id="live-numerical" class="flex-container">
						<div id="number-display" class="text-center padded btn"><h1>52</h1><input type="text" class="form-control" placeholder="Serie 1"><input type="color"></div>
						<div id="number-display" class="text-center padded btn"><h1>42</h1><input type="text" class="form-control" placeholder="Serie 1"><input type="color"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
	const plotly = require("plotly-latest.min.js");
	const storage = require('electron-json-storage');
	const {ipcRenderer} = require("electron");

	var traces = [];
	var live_data = [];

	plotly.newPlot('live-plot', live_data);

	window.onresize = function() {
		console.log("REsfa");
		plotly.Plots.resize("live-plot");
	}

	var new_x, new_y;

	ipcRenderer.on("arduino:data-stream-number", function(e, number_of_streams){
		
		let trace_config = document.querySelector("#trace-config");

		while(trace_config.firstChild){
			trace_config.removeChild(trace_config.firstChild);
		}

		let main_selector, color_selector, name_selector;
		for(let i = 1; i < number_of_streams; i++){
			main_selector = document.createElement("li");
			color_selector = document.createElement("input");
			name_selector = document.createElement("input");
			main_selector.className = "list-group-item form-control";
			color_selector.className = "pull-left";
			color_selector.setAttribute("type", "color");
			name_selector.className = "pull-right";
			name_selector.setAttribute("type", "text")
			name_selector.setAttribute("placeholder", "Serie " + i);
			if(number_of_streams == 2) color_selector.className += " zero-fix";
			main_selector.appendChild(color_selector);
			main_selector.appendChild(name_selector);
			trace_config.appendChild(main_selector);
			color_selector.setAttribute("name", "traceColorSelector" + i);
			name_selector.setAttribute("name", "traceNameSelector" + i);
			name_selector.addEventListener("change", function(e){
				console.log(this.value);
				console.log(this.name);
			});
			traces[i-1] = {x: [], y: [], type: "scatter"};
			live_data[i-1] = traces[i-1];
		}

		window.dispatchEvent(new Event('resize'));
	});

	ipcRenderer.on("arduino:data", function(e, new_data){
		console.log(new_data);
		new_x = [];
		for(let i = 1; i<new_data.length; i++){
			new_x.push([new_data[0]]);
		}
		new_y = [];
		for(let i = 1; i<new_data.length; i++){
			new_y.push([new_data[i]]);
		}
		plotly.extendTraces("live-plot", {x: new_x, y: new_y}, [0,1,2,3], 200);
	});
</script>
</body>
</html>